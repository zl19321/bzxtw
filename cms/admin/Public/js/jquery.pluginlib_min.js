/*
 * Treeview 1.4 - jQuery plugin to hide and show branches of a tree
 *
 * http://bassistance.de/jquery-plugins/jquery-plugin-treeview/
 * http://docs.jquery.com/Plugins/Treeview
 *
 * Copyright (c) 2007 Jörn Zaefferer
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Revision: $Id: jquery.treeview.js 4684 2008-02-07 19:08:06Z joern.zaefferer $
 */
;(function($){$.extend($.fn,{swapClass:function(c1,c2){var c1Elements=this.filter('.'+c1);this.filter('.'+c2).removeClass(c2).addClass(c1);c1Elements.removeClass(c1).addClass(c2);return this;},replaceClass:function(c1,c2){return this.filter('.'+c1).removeClass(c1).addClass(c2).end();},hoverClass:function(className){className=className||"hover";return this.hover(function(){$(this).addClass(className);},function(){$(this).removeClass(className);});},heightToggle:function(animated,callback){animated?this.animate({height:"toggle"},animated,callback):this.each(function(){jQuery(this)[jQuery(this).is(":hidden")?"show":"hide"]();if(callback)callback.apply(this,arguments);});},heightHide:function(animated,callback){if(animated){this.animate({height:"hide"},animated,callback);}else{this.hide();if(callback)this.each(callback);}},prepareBranches:function(settings){if(!settings.prerendered){this.filter(":last-child:not(ul)").addClass(CLASSES.last);this.filter((settings.collapsed?"":"."+CLASSES.closed)+":not(."+CLASSES.open+")").find(">ul").hide();}return this.filter(":has(>ul)");},applyClasses:function(settings,toggler){this.filter(":has(>ul):not(:has(>a))").find(">span").click(function(event){toggler.apply($(this).next());}).add($("a",this)).hoverClass();if(!settings.prerendered){this.filter(":has(>ul:hidden)").addClass(CLASSES.expandable).replaceClass(CLASSES.last,CLASSES.lastExpandable);this.not(":has(>ul:hidden)").addClass(CLASSES.collapsable).replaceClass(CLASSES.last,CLASSES.lastCollapsable);this.prepend("<div class=\""+CLASSES.hitarea+"\"/>").find("div."+CLASSES.hitarea).each(function(){var classes="";$.each($(this).parent().attr("class").split(" "),function(){classes+=this+"-hitarea ";});$(this).addClass(classes);});}this.find("div."+CLASSES.hitarea).click(toggler);},treeview:function(settings){settings=$.extend({cookieId:"treeview"},settings);if(settings.add){return this.trigger("add",[settings.add]);}if(settings.toggle){var callback=settings.toggle;settings.toggle=function(){return callback.apply($(this).parent()[0],arguments);};}function treeController(tree,control){function handler(filter){return function(){toggler.apply($("div."+CLASSES.hitarea,tree).filter(function(){return filter?$(this).parent("."+filter).length:true;}));return false;};}$("a:eq(0)",control).click(handler(CLASSES.collapsable));$("a:eq(1)",control).click(handler(CLASSES.expandable));$("a:eq(2)",control).click(handler());}function toggler(){$(this).parent().find(">.hitarea").swapClass(CLASSES.collapsableHitarea,CLASSES.expandableHitarea).swapClass(CLASSES.lastCollapsableHitarea,CLASSES.lastExpandableHitarea).end().swapClass(CLASSES.collapsable,CLASSES.expandable).swapClass(CLASSES.lastCollapsable,CLASSES.lastExpandable).find(">ul").heightToggle(settings.animated,settings.toggle);if(settings.unique){$(this).parent().siblings().find(">.hitarea").replaceClass(CLASSES.collapsableHitarea,CLASSES.expandableHitarea).replaceClass(CLASSES.lastCollapsableHitarea,CLASSES.lastExpandableHitarea).end().replaceClass(CLASSES.collapsable,CLASSES.expandable).replaceClass(CLASSES.lastCollapsable,CLASSES.lastExpandable).find(">ul").heightHide(settings.animated,settings.toggle);}}function serialize(){function binary(arg){return arg?1:0;}var data=[];branches.each(function(i,e){data[i]=$(e).is(":has(>ul:visible)")?1:0;});$.cookie(settings.cookieId,data.join(""));}function deserialize(){var stored=$.cookie(settings.cookieId);if(stored){var data=stored.split("");branches.each(function(i,e){$(e).find(">ul")[parseInt(data[i])?"show":"hide"]();});}}this.addClass("treeview");var branches=this.find("li").prepareBranches(settings);switch(settings.persist){case"cookie":var toggleCallback=settings.toggle;settings.toggle=function(){serialize();if(toggleCallback){toggleCallback.apply(this,arguments);}};deserialize();break;case"location":var current=this.find("a").filter(function(){return this.href.toLowerCase()==location.href.toLowerCase();});if(current.length){current.addClass("selected").parents("ul, li").add(current.next()).show();}break;}branches.applyClasses(settings,toggler);if(settings.control){treeController(this,settings.control);$(settings.control).show();}return this.bind("add",function(event,branches){$(branches).prev().removeClass(CLASSES.last).removeClass(CLASSES.lastCollapsable).removeClass(CLASSES.lastExpandable).find(">.hitarea").removeClass(CLASSES.lastCollapsableHitarea).removeClass(CLASSES.lastExpandableHitarea);$(branches).find("li").andSelf().prepareBranches(settings).applyClasses(settings,toggler);});}});var CLASSES=$.fn.treeview.classes={open:"open",closed:"closed",expandable:"expandable",expandableHitarea:"expandable-hitarea",lastExpandableHitarea:"lastExpandable-hitarea",collapsable:"collapsable",collapsableHitarea:"collapsable-hitarea",lastCollapsableHitarea:"lastCollapsable-hitarea",lastCollapsable:"lastCollapsable",lastExpandable:"lastExpandable",last:"last",hitarea:"hitarea"};$.fn.Treeview=$.fn.treeview;})(jQuery);;(function($){function load(settings,root,child,container){$.getJSON(settings.url,{root:root},function(response){function createNode(parent){var current=$("<li/>").attr("id",this.id||"").html("<span>"+this.text+"</span>").appendTo(parent);if(this.classes){current.children("span").addClass(this.classes);}if(this.expanded){current.addClass("open");}if(this.hasChildren||this.children&&this.children.length){var branch=$("<ul/>").appendTo(current);if(this.hasChildren){current.addClass("hasChildren");createNode.call({text:"placeholder",id:"placeholder",children:[]},branch);}if(this.children&&this.children.length){$.each(this.children,createNode,[branch])}}}$.each(response,createNode,[child]);$(container).treeview({add:child});});}var proxied=$.fn.treeview;$.fn.treeview=function(settings){if(!settings.url){return proxied.apply(this,arguments);}var container=this;load(settings,"source",this,container);var userToggle=settings.toggle;return proxied.call(this,$.extend({},settings,{collapsed:true,toggle:function(){var $this=$(this);if($this.hasClass("hasChildren")){var childList=$this.removeClass("hasChildren").find("ul");childList.empty();load(settings,this.id,childList,container);}if(userToggle){userToggle.apply(this,arguments);}}}));};})(jQuery);


/*****************************************************************************
[作者]
吴剑 http://wu-jian.cnblogs.com/

[版本记录]
2009-06-01：版本1.0.1发布。
2009-07-05：版本1.0.2，更新了一些明显的BUG，完全支持了IE系列浏览器。
2009-08-15：版本1.0.3，封装了标准DOM，多浏览器下兼容，样式美化，添加了阴影效果。
2009-11-05：版本2.0.0，基于JQuery全新封装，应用了JS的命名空间，避免了客户端id冲突。
			项目正式更名为JQuery Dialog，优化了拖拽的核心实现，完全支持跨浏览器。
2009-12-13：版本2.0.1，优化了核心的拖拽算法，分离出DragAndDrop类。
			使用异步的Javascript让拖拽更为流畅。
			修复了鼠标拖动过快Dialog停顿的BUG。
			对拖拽的位置与滚动条之间进行协调，限制拖拽范围，修复了原有BUG。
			修复了当Dialog宽或高大于页面时定位的BUG。
			修复了鼠标样式与拖拽控制区不精确的BUG。
			至此，完善为一个较为强壮JQuery插件了。
2010-02-03：版本2.0.3，JQuery升级为1.4。
			为Open增加了内部扩展接口。
			修复IE6下部分显示BUG。

*****************************************************************************/
var JqueryDialog={"cBackgroundColor":"#ffffff","cBorderSize":0,"cBorderColor":"#999999","cHeaderBackgroundColor":"#f0f0f0","cCloseText":"X 关闭","cCloseTitle":"关闭","cSubmitText":"确 认","cCancelText":"取 消","cDragTime":"100",Open:function(dialogTitle,iframeSrc,iframeWidth,iframeHeight){JqueryDialog.init(dialogTitle,iframeSrc,iframeWidth,iframeHeight,true,true,true);},Open1:function(dialogTitle,iframeSrc,iframeWidth,iframeHeight,isSubmitButton,isCancelButton,isDrag){JqueryDialog.init(dialogTitle,iframeSrc,iframeWidth,iframeHeight,isSubmitButton,isCancelButton,isDrag);},init:function(dialogTitle,iframeSrc,iframeWidth,iframeHeight,isSubmitButton,isCancelButton,isDrag){var _client_width=document.body.clientWidth;var _client_height=document.documentElement.scrollHeight;if(typeof($("#jd_shadow")[0])=="undefined"){$("body").prepend("<div id='jd_shadow'>&nbsp;</div>");var _jd_shadow=$("#jd_shadow");_jd_shadow.css("width",_client_width+"px");_jd_shadow.css("height",_client_height+"px");}if(typeof($("#jd_dialog")[0])!="undefined"){$("#jd_dialog").remove();}$("body").prepend("<div id='jd_dialog'></div>");var _jd_dialog=$("#jd_dialog");var _left=(_client_width-(iframeWidth+JqueryDialog.cBorderSize*2+5))/2;_jd_dialog.css("left",(_left<0?0:_left)+document.documentElement.scrollLeft+"px");var _top=(document.body.clientHeight-(iframeHeight+JqueryDialog.cBorderSize*2+30+50+5))/2;_jd_dialog.css("top",(_top<0?document.documentElement.scrollTop:_top)+"px");_jd_dialog.append("<div id='jd_dialog_s'>&nbsp;</div>");var _jd_dialog_s=$("#jd_dialog_s");_jd_dialog_s.css("width",iframeWidth+JqueryDialog.cBorderSize*2+"px");_jd_dialog_s.css("height",iframeHeight+JqueryDialog.cBorderSize*2+59+"px");_jd_dialog.append("<div id='jd_dialog_m'></div>");var _jd_dialog_m=$("#jd_dialog_m");_jd_dialog_m.css("border",JqueryDialog.cBorderColor+" "+JqueryDialog.cBorderSize+"px solid");_jd_dialog_m.css("width",iframeWidth+"px");_jd_dialog_m.css("background-color",JqueryDialog.cBackgroundColor);_jd_dialog_m.append("<div id='jd_dialog_m_h'></div>");var _jd_dialog_m_h=$("#jd_dialog_m_h");_jd_dialog_m_h.css("background-color",JqueryDialog.cHeaderBackgroundColor);_jd_dialog_m_h.append("<span id='jd_dialog_m_h_l'>"+dialogTitle+"</span>");_jd_dialog_m_h.append("<span id='jd_dialog_m_h_r'><a href='#' title='"+JqueryDialog.cCloseTitle+"' onclick='JqueryDialog.Close();return false;'>"+JqueryDialog.cCloseText+"</a></span>");_jd_dialog_m.append("<div id='jd_dialog_m_b'></div>");var _jd_dialog_m_b=$("#jd_dialog_m_b");_jd_dialog_m_b.css("width",iframeWidth+"px");_jd_dialog_m_b.css("height",iframeHeight+"px");_jd_dialog_m_b.append("<div id='jd_dialog_m_b_1'>&nbsp;</div>");var _jd_dialog_m_b_1=$("#jd_dialog_m_b_1");_jd_dialog_m_b_1.css("top","30px");_jd_dialog_m_b_1.css("width",iframeWidth+"px");_jd_dialog_m_b_1.css("height",iframeHeight+"px");_jd_dialog_m_b_1.css("display","none");_jd_dialog_m_b.append("<div id='jd_dialog_m_b_2'></div>");$("#jd_dialog_m_b_2").append("<iframe id='jd_iframe' src='"+iframeSrc+"' scrolling='yes' frameborder='0' width='"+iframeWidth+"' height='"+iframeHeight+"' />");_jd_dialog_m.append("<div id='jd_dialog_m_t'></div>");var _jd_dialog_m_t=$("#jd_dialog_m_t");if(isSubmitButton){_jd_dialog_m_t.append("<label class='btn'><input id='jd_submit' value='"+JqueryDialog.cSubmitText+"' type='button' onclick='JqueryDialog.Ok();' class='submit'/></label>");}if(isCancelButton){_jd_dialog_m_t.append("<label class='btn'><input id='jd_cancel' value='"+JqueryDialog.cCancelText+"' type='button' onclick='JqueryDialog.Close();' class='submit'/></label>");}if(isDrag){DragAndDrop.Register(_jd_dialog[0],_jd_dialog_m_h[0]);}},Close:function(){$("#jd_shadow").remove();$("#jd_dialog").remove();},Ok:function(){var frm=$("#jd_iframe");if(frm[0].contentWindow.Ok()){JqueryDialog.Close();}else{frm[0].focus();}},SubmitCompleted:function(alertMsg,isCloseDialog,isRefreshPage){if($.trim(alertMsg).length>0){alert(alertMsg);}if(isCloseDialog){JqueryDialog.Close();if(isRefreshPage){window.location.href=window.location.href;}}}};var DragAndDrop=function(){var _clientWidth;var _clientHeight;var _controlObj;var _dragObj;var _flag=false;var _dragObjCurrentLocation;var _mouseLastLocation;var getElementDocument=function(element){return element.ownerDocument||element.document;};var dragMouseDownHandler=function(evt){if(_dragObj){evt=evt||window.event;_clientWidth=document.body.clientWidth;_clientHeight=document.documentElement.scrollHeight;$("#jd_dialog_m_b_1").css("display","");_flag=true;_dragObjCurrentLocation={x:$(_dragObj).offset().left,y:$(_dragObj).offset().top};_mouseLastLocation={x:evt.screenX,y:evt.screenY};$(document).bind("mousemove",dragMouseMoveHandler);$(document).bind("mouseup",dragMouseUpHandler);if(evt.preventDefault)evt.preventDefault();else
evt.returnValue=false;}};var dragMouseMoveHandler=function(evt){if(_flag){evt=evt||window.event;var _mouseCurrentLocation={x:evt.screenX,y:evt.screenY};_dragObjCurrentLocation.x=_dragObjCurrentLocation.x+(_mouseCurrentLocation.x-_mouseLastLocation.x);_dragObjCurrentLocation.y=_dragObjCurrentLocation.y+(_mouseCurrentLocation.y-_mouseLastLocation.y);_mouseLastLocation=_mouseCurrentLocation;$(_dragObj).css("left",_dragObjCurrentLocation.x+"px");$(_dragObj).css("top",_dragObjCurrentLocation.y+"px");if(evt.preventDefault)evt.preventDefault();else
evt.returnValue=false;}};var dragMouseUpHandler=function(evt){if(_flag){evt=evt||window.event;$("#jd_dialog_m_b_1").css("display","none");cleanMouseHandlers();_flag=false;}};var cleanMouseHandlers=function(){if(_controlObj){$(_controlObj.document).unbind("mousemove");$(_controlObj.document).unbind("mouseup");}};return{Register:function(dragObj,controlObj){_dragObj=dragObj;_controlObj=controlObj;$(_controlObj).bind("mousedown",dragMouseDownHandler);}}}();